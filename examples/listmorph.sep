predicate lseg(loc x, set s) {
|  x == null    |=> {s =i 0; emp;}
|  !(x == null) |=> {s =i v ++ ss; [x, 2] | <x, 0> -> v | <x, 1> -> nxt | lseg(nxt, ss);}
}

predicate lsegtwo(loc x, set s) {
|  x == null    |=> {s =i 0; emp;}
|  !(x == null) |=> {s =i v ++ ss; [x, 3] | <x, 0> -> v | <x, 1> -> v + 1 | <x, 2> -> nxt | lsegtwo(nxt, ss);}
}

{true; <r, 0> -> null | lseg(x, s);}
listfree(loc x, loc r)
{true; <r, 0> -> y | lsegtwo(y, s);}

